# Integration Test Instructions - 3Dアバター機能 Phase 3（拡張実装）

## 目的
Phase 3で追加された機能間の連携が正しく動作することを検証する。

## テストシナリオ

### シナリオ1: ジェスチャーデータフロー（バックエンド → フロントエンド）
- **説明**: realtime-scoringエージェントが返すgestureフィールドがアバターのアニメーションに反映されること
- **前提条件**: CDKデプロイ完了、セッション開始可能な状態
- **テスト手順**:
  1. シナリオを選択してセッションを開始
  2. ユーザーがメッセージを送信
  3. リアルタイム評価レスポンスにgestureフィールドが含まれることを確認（DevTools Network）
  4. アバターがうなずき or 首かしげアニメーションを実行することを目視確認
  5. 1500ms後にgestureがリセットされることを確認
- **期待結果**: gesture値に応じたアニメーションが再生され、自動リセットされる

### シナリオ2: アバターアップロード → 管理 → 使用フロー
- **説明**: VRMファイルのアップロードから使用までのE2Eフロー
- **前提条件**: CDKデプロイ完了、Cognito認証済み
- **テスト手順**:
  1. アバター管理画面を開く
  2. VRMファイル（50MB以下）をアップロード
  3. アップロード完了後、アバター一覧に表示されることを確認
  4. アップロードしたアバターを選択
  5. 会話画面でアバターが表示されることを確認
  6. アバターを削除し、一覧から消えることを確認
- **期待結果**: アップロード→選択→表示→削除の全フローが正常動作

### シナリオ3: アイドルモーション + 感情トランジション統合
- **説明**: アイドルモーション（視線移動、体揺れ）と感情トランジションが同時に正しく動作すること
- **前提条件**: アバターが表示されている状態
- **テスト手順**:
  1. セッション開始前にアイドルモーション（視線移動、体揺れ）が動作していることを確認
  2. セッション開始し、NPC発話中にアイドルモーションが抑制されることを確認
  3. 感情状態が変化した時にトランジションアニメーションが滑らかに遷移することを確認
  4. 発話終了後にアイドルモーションが再開されることを確認
- **期待結果**: アイドルモーションと感情トランジションが干渉せず正常動作

### シナリオ4: レスポンシブレイアウト
- **説明**: 画面サイズ変更時にアバター表示が適切にリサイズされること
- **テスト手順**:
  1. デスクトップサイズ（1920x1080）でアバターが正常表示されることを確認
  2. タブレットサイズ（768x1024）にリサイズし、レイアウトが崩れないことを確認
  3. モバイルサイズ（375x667）にリサイズし、アバターが適切にリサイズされることを確認
  4. DevToolsのレスポンシブモードで各サイズを確認
- **期待結果**: 全サイズでアバターが適切に表示される

### シナリオ5: 回帰テスト（Phase 1/2機能）
- **説明**: Phase 3の変更がPhase 1/2の機能に影響を与えていないこと
- **テスト手順**:
  1. VRMモデルが正常にロードされること（Phase 1）
  2. 瞬きアニメーションが動作すること（Phase 1）
  3. リップシンク（Viseme）が動作すること（Phase 2）
  4. AI感情分析による表情変化が動作すること（Phase 2）
  5. 複数アバター切り替えが動作すること（Phase 2）
- **期待結果**: Phase 1/2の全機能が正常動作

## E2Eテスト実行

### 既存E2Eテスト
```bash
cd frontend
npx playwright test avatar-emotion-test.spec.ts --project=chromium
```

### 手動テスト環境
- **URL**: `https://d3fyq5o4obzach.cloudfront.net`
- **テストユーザー**: ステージング環境の認証情報を使用
- **ブラウザ**: Chrome最新版（WebGL対応必須）
