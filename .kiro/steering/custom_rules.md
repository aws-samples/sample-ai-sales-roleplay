# カスタムルール

## 言語設定
- 常に日本語で応答すること
- 技術用語は必要に応じて英語の原語も併記すること
- 敬語を使用し、丁寧な口調を維持すること

## コーディングスタイル
- コメントは日本語で記述すること
- 変数名・関数名は英語のままとすること
- エラーメッセージは日本語と英語の両方で提供すること

## ドキュメント形式
- 見出しは「#」記号を使用すること
- 重要な情報は「**太字**」で強調すること
- コード例は必ずコードブロック（```）内に記述すること

## 応答スタイル
- 簡潔かつ明確な説明を心がけること
- 複雑な概念は具体例を用いて説明すること
- 選択肢を提示する場合は、番号付きリストを使用すること

## 開発制限事項
- **CDKのnpm run buildは実行禁止**: CDKディレクトリでの`npm run build`コマンドは実行しないこと
- **AWS環境更新はCDKのみ**: AWS環境（Lambda、DynamoDB、S3等）の更新は必ずCDKを通して行うこと
  - AWS CLIでの直接的なLambda関数更新は禁止
  - AWS CLIでのリソース作成・削除は禁止
  - AWS環境の変更は必ず`npm run deploy:dev`等のCDKコマンドを使用すること
  - 調査目的でのAWS CLI使用（describe、list、get等の読み取り専用コマンド）は許可
- **API認証**: すべてのAPI呼び出しでCognito IDトークンによる認証を必須とすること
- **エラーハンドリング**: フロントエンドでは必ずtry-catchでエラーを適切に処理すること
- **型安全性**: TypeScriptの型定義を厳密に行い、anyの使用を避けること
- **セキュリティ**: CDK Nagによるセキュリティチェックを必須とすること
- **国際化**: 新しいテキストは必ずi18nキーを使用し、日英両言語に対応すること
- **動画処理**: セッション録画は自動化し、手動操作を最小限に抑えること
- **パフォーマンス**: React Hooksの依存関係を適切に管理し、不要な再レンダリングを防ぐこと

## API実装ガイドライン
- **レスポンス形式**: 統一されたレスポンス形式（success, message, dataプロパティ）を使用すること
- **エラーレスポンス**: エラー時は適切なHTTPステータスコードとエラーメッセージを返すこと
- **ページネーション**: 大量データの取得時はnextTokenベースのページングを実装すること
- **ファイル処理**: S3署名付きURLを使用した直接アップロード方式を採用すること

## フロントエンド実装ガイドライン
- **状態管理**: React Context APIを使用し、グローバル状態を適切に管理すること
- **コンポーネント設計**: 単一責任の原則に従い、再利用可能なコンポーネントを作成すること
- **パフォーマンス**: useMemo、useCallbackを適切に使用してレンダリング最適化を行うこと
- **アクセシビリティ**: WCAG 2.1 AA基準に準拠したアクセシブルなUIを実装すること
- **動画録画**: VideoRecorderコンポーネントは自動化され、セッション状態に連動すること
- **絵文字フィードバック**: 感情状態の変化を適切に通知し、アクセシビリティに配慮すること
- **国際化**: useTranslationフックを使用し、すべてのテキストを多言語対応すること
- **テスト**: Jest + React Testing Library + Playwrightによる包括的なテストを実装すること

## Git操作・CI/CDガイドライン
- **プッシュ前のローカルチェック推奨**: `git push`する前に以下のCIチェックをローカルで実行することを推奨
  1. フロントエンドリント: `cd frontend && npm run lint`
  2. フロントエンドユニットテスト: `cd frontend && npm run test`
  3. TypeScript型チェック: getDiagnosticsツールで変更ファイルを確認
- **E2Eテスト実行確認**: フロントエンドの変更がある場合、プッシュ前にE2Eテストを実行するかユーザーに確認すること
  - 確認メッセージ例: 「E2Eテストを実行しますか？（実行コマンド: `cd frontend && npx playwright test --project=chromium`）」
  - 実行コマンド: `cd frontend && npx playwright test --project=chromium`
  - 特定のテストのみ実行: `cd frontend && npx playwright test scenario-execution.spec.ts --project=chromium`
  - テスト結果レポート確認: `frontend/playwright-report/index.html`
- **リントエラーゼロ**: リントエラーが残っている状態でプッシュしないこと
- **テスト通過推奨**: ユニットテストの通過を推奨、E2Eテストはユーザー判断に委ねる
- **PRレビュー対応**: PRのコメントやセキュリティ指摘は必ず対応してからマージすること
- **コミットメッセージ**: 日本語で簡潔かつ明確なコミットメッセージを記述すること

## E2Eテストガイドライン
- **テストファイル配置**: `frontend/src/tests/e2e/` ディレクトリに配置すること
- **ヘルパー関数**: 共通処理は `frontend/src/tests/e2e/helpers/` に配置すること
- **テスト環境**: ステージング環境（CloudFront経由）に対して実行すること
- **認証情報**: テスト用ユーザー認証情報は `.env.test` ファイルで管理すること
- **タイムアウト設定**: 長時間かかるテストは `test.setTimeout()` で適切なタイムアウトを設定すること
- **セレクター**: `data-testid` 属性を優先し、テキストベースのセレクターは多言語対応を考慮すること
- **待機処理**: 明示的な待機（`waitForTimeout`）より、要素の表示待機（`expect().toBeVisible()`）を優先すること